<div class="row" style="padding: 10px">
  <div class="col-12 report-header">
    <h3>Datasets reports</h3>
    <hr style="margin: 0" />
  </div>

  <div class="col-12" *ngIf="!(dataSets$ | async)">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  </div>
  <div
    class="col-12 filters"
    *ngIf="(dataSets$ | async) && (dataSets$ | async).length > 0"
  >
    <div style="min-width: 30%; float: left;">
      <mat-form-field class="datasets" style="width: 100%">
        <mat-label>Dataset</mat-label>
        <mat-select id="dataset" [(value)]="selectedDataSet">
          <mat-option
            [value]="dataSet"
            (onSelectionChange)="onDataSetSelectionChanged(dataSet)"
            *ngFor="let dataSet of dataSets$ | async"
            >{{ dataSet.name }}</mat-option
          >
        </mat-select>
      </mat-form-field>
    </div>
    <div
      style="width: 20%; float: left;"
      *ngIf="
        selectedDataSet &&
        selectedDataSet['categoryCombo']['categoryOptionCombos'] &&
        selectedDataSet['categoryCombo']['categoryOptionCombos'][0]['name'] !=
          'default' &&
        !(dataSetDimensions$ | async)
      "
    >
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </div>
    <div style="width: 20%; float: left;" *ngIf="dataSetDimensions$ | async">
      <mat-form-field
        class="datasets-dimensions"
        style="margin-left: 6px; width: 100%"
      >
        <mat-label>Dataset dimension</mat-label>
        <mat-select
          id="dataset-dimensions"
          [(value)]="selectedDataSetDimension"
        >
          <mat-option
            [value]="dataSetDimension"
            (onSelectionChange)="onDimensionSelectionChanged(dataSetDimension)"
            *ngFor="
              let dataSetDimension of (dataSetDimensions$ | async)?.dimensions
            "
            >{{ dataSetDimension.name }}</mat-option
          >
        </mat-select>
      </mat-form-field>
    </div>
    <div style="width: 40%; float: left;margin-left: 4px;">
      <ngx-dhis2-selection-filters
        [selectionFilterConfig]="selectionFilterConfig"
        (filterUpdate)="onFilterUpdate($event)"
      >
      </ngx-dhis2-selection-filters>
    </div>
  </div>
  <div
    class="col-12"
    style="margin-top: 50px"
    *ngIf="!(dataSets$ | async) && (dataSets$ | async).length == 0"
  >
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  </div>
  <div
    class="col-12"
    *ngIf="
      (currentUser$ | async) &&
      filterSelections &&
      filterSelections.length > 1 &&
      (dataSets$ | async) &&
      selectionChanged
    "
  >
    <app-report
      [dataSetId]="dataSetId"
      [filterDimension]="filterDimension"
      [currentUser]="currentUser$ | async"
      [filterSelections]="filterSelections"
      [dataSets]="dataSets$ | async"
    ></app-report>
  </div>
  <div class="col-12" style="margin-top: 50px" *ngIf="!selectionChanged">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  </div>
</div>
